using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Drawing;

public partial class Admin_frmViewServiceTaxPayment : System.Web.UI.Page
{
    SqlConnection con = new SqlConnection(ConfigurationManager.AppSettings["esselDB"]);

    SqlCommand cmd = new SqlCommand();
    SqlDataReader dr;
    SqlDataAdapter da;
    DataSet ds = new DataSet();
    protected void Page_Load(object sender, EventArgs e)
    {
        Essel childmaster = (Essel)this.Master;
        HtmlAnchor lbl = (HtmlAnchor)childmaster.FindControl("Accounting");
        lbl.Attributes.Add("class", "active");

        if (Session["user"] == null)
            Response.Redirect("SessionExpire.aspx");
        if (!IsPostBack)
        {
            trexcel.Visible = true;
        }
    }
     protected void GridView1_RowCreated(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.Header)
        {
            GridView HeaderGrid2 = (GridView)sender;
            GridViewRow HeaderRow2 = new GridViewRow(0, 0, DataControlRowType.Header, DataControlRowState.Insert);
            TableCell Cell_Header2 = new TableCell();
            if (ddltype.SelectedItem.Text == "ServiceTax")
            {
                Cell_Header2.Text = "View ServiceTax";
            }

            else if (ddltype.SelectedItem.Text == "Excise")
            {
                Cell_Header2.Text = "View ExciseDuty";
            }
            Cell_Header2.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header2.ColumnSpan = 9;
            Cell_Header2.RowSpan = 1;
            HeaderRow2.Cells.Add(Cell_Header2);

            GridView1.Controls[0].Controls.AddAt(0, HeaderRow2);

            GridView HeaderGrid3 = (GridView)sender;
            GridViewRow HeaderRow3 = new GridViewRow(0, 1, DataControlRowType.Header, DataControlRowState.Insert);
            TableCell Cell_Header3 = new TableCell();
            Cell_Header3 = new TableCell();
            Cell_Header3.Text = "Date";
            Cell_Header3.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header3.ColumnSpan = 1;
            Cell_Header3.RowSpan = 3;
            HeaderRow3.Cells.Add(Cell_Header3);

            Cell_Header3 = new TableCell();
            Cell_Header3.Text = "Claimed from Client";
            Cell_Header3.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header3.ColumnSpan = 4;
          
            HeaderRow3.Cells.Add(Cell_Header3);

            Cell_Header3 = new TableCell();
            Cell_Header3.Text = "Paid";
            Cell_Header3.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header3.ColumnSpan = 3;
            HeaderRow3.Cells.Add(Cell_Header3);

            Cell_Header3 = new TableCell();
            Cell_Header3.Text = "Balance";
            Cell_Header3.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header3.ColumnSpan = 1;
            Cell_Header3.RowSpan = 3;
            HeaderRow3.Cells.Add(Cell_Header3);
            GridView1.Controls[0].Controls.AddAt(1, HeaderRow3);

            GridView HeaderGrid4 = (GridView)sender;
            GridViewRow HeaderRow4 = new GridViewRow(0, 2, DataControlRowType.Header, DataControlRowState.Insert);
            TableCell Cell_Header4 = new TableCell();
            Cell_Header4 = new TableCell();

            Cell_Header4 = new TableCell();
            if (ddltype.SelectedItem.Text == "ServiceTax")
            {
                Cell_Header4.Text = "NetServicetax";
            }
            else if (ddltype.SelectedItem.Text == "Excise")
            {
                Cell_Header4.Text = "ExciseDuty";
            }
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 1;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 2;

            Cell_Header4 = new TableCell();
            Cell_Header4.Text = "NetEdcess";
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 1;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 2;


            Cell_Header4 = new TableCell();
            Cell_Header4.Text = "NetHedcess";
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 1;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 2;

            Cell_Header4 = new TableCell();
            if (ddltype.SelectedItem.Text == "ServiceTax")
            {
                Cell_Header4.Text = "Servicetax";
            }
            else if (ddltype.SelectedItem.Text == "Excise")
            {
                Cell_Header4.Text = "NetExciseDuty";
            }
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 1;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 2;

            Cell_Header4 = new TableCell();
            Cell_Header4.Text = "ToVendor";
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 1;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 2;


            Cell_Header4 = new TableCell();
            Cell_Header4.Text = "ToGovernment";
            Cell_Header4.HorizontalAlign = HorizontalAlign.Center;
            Cell_Header4.ColumnSpan = 2;
            HeaderRow4.Cells.Add(Cell_Header4);
            Cell_Header4.RowSpan = 1;
            GridView1.Controls[0].Controls.AddAt(2, HeaderRow4);
        }
    }
     protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
     {
         if (e.Row.RowType == DataControlRowType.Header)
         {
           
             e.Row.Cells[0].Visible = false;
             //e.Row.Cells[1].Visible = false;
             e.Row.Cells[1].Visible = false;

             e.Row.Cells[2].Visible = false;
             e.Row.Cells[3].Visible = false;
             e.Row.Cells[4].Visible = false;
             e.Row.Cells[5].Visible = false;
             //e.Row.Cells[6].Visible = false;
             //e.Row.Cells[7].Visible = false;
             e.Row.Cells[8].Visible = false;
             if (ddltype.SelectedItem.Text == "ServiceTax")
             {
                 e.Row.Cells[6].Text = "Service Tax to Govt";
                 e.Row.Cells[7].Text = "Service tax Penel Interest";
             }
             else if (ddltype.SelectedItem.Text == "Excise")
             {
                 e.Row.Cells[6].Text = "Excise to Govt";
                 e.Row.Cells[7].Text = "Excise Penel Interest";
             }
             
         }
         if (e.Row.RowType == DataControlRowType.DataRow)
         {
             ServiceTax += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Servicetax"));
             Edcess += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Edcess"));
             Hedcess += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Hedcess"));
             TotalServiceTax += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "TotalServiceTax"));
             Vendor += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Vendor"));
             Govt += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Govt"));
             PTax += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "PTax"));
             Balance += (Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "TotalServiceTax")) - (Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Vendor")) + Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Govt"))));

             if (rbtnpaiddate.Checked == true)
             {
                 e.Row.Cells[1].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[2].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[3].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[4].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[5].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=2&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[6].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=3&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[7].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=3&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invdate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");

             }
             else if (rbtninvmkdate.Checked == true)
             {
                 e.Row.Cells[1].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[2].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[3].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[4].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=1&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[5].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=2&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[6].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=3&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");
                 e.Row.Cells[7].Attributes.Add("onclick", "window.open('detailviewservicetaxpayment.aspx?Regno=" + ddlno.SelectedValue + " &Date=" + e.Row.Cells[0].Text + "&Taxtype=" + ddltype.SelectedValue + "&type=3&Fdate=" + txtfrom.Text + "&Todate=" + txtto.Text + "&datetype=Invmakedate ','Report','width=900,height=500,toolbar=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no'); return false;");

             }


         }
         if (e.Row.RowType == DataControlRowType.Footer)
         {
             e.Row.Cells[1].Text = String.Format("{0:#,##,##,###.00}", ServiceTax);
             e.Row.Cells[2].Text = String.Format("{0:#,##,##,###.00}", Edcess);
             e.Row.Cells[3].Text = String.Format("{0:#,##,##,###.00}", Hedcess);
             e.Row.Cells[4].Text = String.Format("{0:#,##,##,###.00}", TotalServiceTax);
             e.Row.Cells[5].Text = String.Format("{0:#,##,##,###.00}", Vendor);
             e.Row.Cells[6].Text = String.Format("{0:#,##,##,###.00}", Govt);
             e.Row.Cells[7].Text = String.Format("{0:#,##,##,###.00}", PTax);
             e.Row.Cells[8].Text = String.Format("{0:#,##,##,###.00}", Balance);
             if (ServiceTax < 0)
                 e.Row.Cells[1].ForeColor = System.Drawing.Color.Red;
             if (Edcess < 0)
                 e.Row.Cells[2].ForeColor = System.Drawing.Color.Red;
             if (Hedcess < 0)
                 e.Row.Cells[3].ForeColor = System.Drawing.Color.Red;
             if (TotalServiceTax < 0)
                 e.Row.Cells[4].ForeColor = System.Drawing.Color.Red;
             if (Vendor < 0)
                 e.Row.Cells[5].ForeColor = System.Drawing.Color.Red;
             if (Govt < 0)
                 e.Row.Cells[6].ForeColor = System.Drawing.Color.Red;
             if (PTax < 0)
                 e.Row.Cells[7].ForeColor = System.Drawing.Color.Red;
             if (Balance < 0)
                 e.Row.Cells[8].ForeColor = System.Drawing.Color.Red;

         }


     }
     private decimal ServiceTax = (decimal)0.0;
     private decimal Edcess = (decimal)0.0;
     private decimal Hedcess = (decimal)0.0;
     private decimal TotalServiceTax = (decimal)0.0;
     private decimal Vendor = (decimal)0.0;
     private decimal Govt = (decimal)0.0;
     private decimal PTax = (decimal)0.0;
     private decimal Balance = (decimal)0.0;



     protected void btnAssign_Click(object sender, EventArgs e)
     {
         try
         {
             //string Fromdate = txtfrom.Text;
             //DateTime fdate = Convert.ToDateTime(Fromdate);
             //int FMonth = fdate.Month;
             //int Fyear = fdate.Year;
             string Condition = "";
            
                 if (ddltype.SelectedItem.Text == "ServiceTax")
                 {
                     if (ddlno.SelectedItem.Text != "Select All")
                     {
                         if (rbtnpaiddate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax], convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service')) and (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty') and p.dca_code='DCA-SRTX' and  convert(datetime,b.ModifiedDate) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax], convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service')) and (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty') and p.dca_code='DCA-SRTX' and  convert(datetime,b.ModifiedDate) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                         }
                         else if (rbtninvmkdate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service'))and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-SRTX' and  convert(datetime,p.Inv_Making_Date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service'))and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-SRTX' and  convert(datetime,p.Inv_Making_Date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.SrtxReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and s.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.SrtxReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                         }
                     }
                     else
                     {
                         if (rbtnpaiddate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax], convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service')) and (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty') and p.dca_code='DCA-SRTX' and  convert(datetime,b.ModifiedDate) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax], convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service')) and (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty') and p.dca_code='DCA-SRTX' and  convert(datetime,b.ModifiedDate) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join servicetax_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)cptax on ptax.date=cptax.date order by date";
                         }
                         else if (rbtninvmkdate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service'))and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-SRTX' and  convert(datetime,p.Inv_Making_Date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.ModifiedDate end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetServicetax),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join ServiceTax_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Invoice Service','Advance') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Service'))and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join ServiceTax_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-SRTX' and  convert(datetime,p.Inv_Making_Date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select b.ModifiedDate,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "'  group by b.ModifiedDate) d on s.date=d.ModifiedDate)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) as Decimal(20,2)) PTax from bankbook b join ServiceTax_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join ServiceTax_Account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-SRTX' and sub_dca='DCA-SRTX .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date)between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)cptax on ptax.date=cptax.date order by date";
                         }
                     }
                 }
                 else if (ddltype.SelectedItem.Text == "Excise")
                 {
                     if (ddlno.SelectedItem.Text != "Select All")
                     {
                         if (rbtnpaiddate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,b.ModifiedDate) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date) d on s.date=d.date)Tax  full outer join  (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,b.ModifiedDate) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date) d on s.date=d.date)Tax  full outer join  (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";

                         }
                         else if (rbtninvmkdate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,p.Inv_Making_Date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date) d on s.date=d.date)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,Inv_Making_Date) is  null then convert(datetime,b.createddate) else convert(datetime,Inv_Making_Date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,p.Inv_Making_Date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and b.ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date) d on s.date=d.date)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and ExciseReg_No='" + ddlno.SelectedItem.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' and e.ExciseReg_No='" + ddlno.SelectedItem.Text + "'  group by date)cptax on ptax.date=cptax.date order by date";
                         }
                     }
                     else
                     {
                         if (rbtnpaiddate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,b.ModifiedDate) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date) d on s.date=d.date)Tax  full outer join  (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)cptax on ptax.date=cptax.date order by date";
                             //Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.ModifiedDate is  null then ch.ModifiedDate else c.ModifiedDate  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS decimal(15,2)) as vendor from (Select b.ModifiedDate,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and   (case when convert(datetime,invoice_date) is  null then convert(datetime,b.createddate) else convert(datetime,invoice_date)  end ) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by b.ModifiedDate) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status='4' and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,b.ModifiedDate) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by DATEADD(dd, 0, DATEDIFF(dd, 0,b.ModifiedDate))) ch on c.ModifiedDate=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date) d on s.date=d.date)Tax  full outer join  (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)PTax on Tax.date=PTax.date)Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "'  group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)cptax on ptax.date=cptax.date order by date";
                         }
                         else if (rbtninvmkdate.Checked == true)
                         {
                             Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and convert(datetime,Inv_Making_Date)   between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,p.Inv_Making_Date) between '" + txtfrom.Text + "' and '" + txtto.Text + "'  group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date) d on s.date=d.date)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "'  group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '" + txtfrom.Text + "' and '" + txtto.Text + "' group by date)cptax on ptax.date=cptax.date order by date";
                             // Condition = Condition + "select  (case when cptax.date is not null then cptax.date else ptax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],isnull(Cashptax,0)+isnull(PTax,0)as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(Cashptax,0)+ISNULL(PTax,0))) AS Decimal(20,2))[Balance] from (select  (case when Ctax.date is not null then Ctax.date else Ttax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0)+ISNULL(CashGovttax,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0)+ISNULL(CashGovttax,0))) AS Decimal(20,2))[Balance] from (select  (case when Tax.date is not null then Tax.date else PTax.date end) date,convert(decimal(10,2),isnull(Servicetax,0))as[Servicetax],convert(decimal(10,2),isnull(Edcess,0))as[Edcess],convert(decimal(10,2),isnull(Hedcess,0))as[Hedcess],convert(decimal(15,2),isnull(TotalServicetax,0))as[TotalServicetax],convert(decimal(15,2),isnull(vendor,0))as[Vendor],convert(decimal(15,2),isnull(Govt,0))as[Govt],CAST(isnull(PTax,0) as Decimal(20,2))as[PTax],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from (select  (case when s.date is not null then s.date else d.date end) date,CAST(isnull(Servicetax,0) as decimal(20,2))as[Servicetax],CAST(isnull(Edcess,0) as decimal(20,2))as[Edcess],CAST(isnull(Hedcess,0) AS Decimal(20,2))as[Hedcess],CAST(isnull(TotalServicetax,0) AS Decimal(20,2))as[TotalServicetax],CAST(isnull(vendor,0) AS Decimal(20,2))as[Vendor],CAST(isnull(Govt,0) AS Decimal(20,2))as[Govt],CAST((isnull(TotalServiceTax,0)-(isnull(vendor,0)+isnull(Govt,0))) AS Decimal(20,2))[Balance] from ((Select  (case when c.Inv_Making_Date is  null then ch.ModifiedDate else c.Inv_Making_Date  end)date,CAST(Servicetax AS Decimal(20,2)) as servicetax ,CAST(Edcess AS Decimal(20,2)) as Edcess,CAST(Hedcess AS Decimal(20,2)) as Hedcess,CAST((isnull(Edcess,0)+isnull(Hedcess,0)+isnull(Servicetax,0)) AS Decimal(20,2))as[TotalServiceTax],CAST(Vendor AS Decimal(15,2)) as vendor from (Select Inv_Making_Date,CAST(isnull(Sum(i.NetExciseDuty),0) AS Decimal(20,2))Servicetax,CAST(isnull(sum(i.NetEdcess),0) AS Decimal(20,2))Edcess,CAST(isnull(sum(i.NetHedcess),0) AS Decimal(20,2)) Hedcess from invoice i join Excise_Account b on (b.invoiceno=i.invoiceno or convert(varchar(20),i.Transaction_no)=b.invoiceno) where  i.paymenttype in ('Manufacturing','Advance','Invoice Service') and i.status='Credit' and i.cc_code in (select cc_code from cost_center where cc_type='Performing' and cc_subtype in ('Manufacturing','Trading')) and convert(datetime,Inv_Making_Date)   between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by Inv_Making_Date) c full outer join (Select DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))ModifiedDate,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2))as vendor from pending_invoice p join Excise_Account b on b.invoiceno=p.invoiceno where  b.status in ('1','2','3','4') and p.paymenttype in ('Service Tax','Excise Duty')  and p.dca_code='DCA-Excise' and  convert(datetime,p.Inv_Making_Date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "'  group by DATEADD(dd, 0, DATEDIFF(dd, 0,p.Inv_Making_Date))) ch on c.Inv_Making_Date=ch.ModifiedDate))s full outer join (Select date,CAST(isnull(Sum(b.Debit),0) AS Decimal(20,2)) Govt from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and b.PaymentType='General' and s.Status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date) d on s.date=d.date)Tax full outer join (Select date,CAST(isnull(Sum(b.debit),0) AS Decimal(20,2)) PTax from bankbook b join Excise_Account S on b.InvoiceNo=s.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and b.PaymentType='General' and s.status in ('4') and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "'  group by date)PTax on Tax.date=PTax.date )Ttax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) CashGovttax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .1' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)Ctax on Ttax.date=Ctax.date)ptax full outer join (Select date,CAST(isnull(Sum(c.debit),0) as Decimal(20,2)) Cashptax from cash_book c join excise_account e on c.InvoiceNo=e.InvoiceNo where dca_code='DCA-Excise' and sub_dca='DCA-Excise .2' and e.PaymentType='Govt' and e.status in ('2')  and convert(datetime,date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "' group by date)cptax on ptax.date=cptax.date order by date";
                         }
                     }
                 }
            
             ViewState["Condition"] = Condition;
             // JavaScript.Alert(Condition);
             fillgrid();
         }
         catch (Exception ex)
         {
             Utilities.CatchException(ex);
             JavaScript.Alert(ConfigurationManager.AppSettings["ExceptionMessage"].ToString());
         }
     }
     public void fillgrid()
     {
         try
         {
             da = new SqlDataAdapter(ViewState["Condition"].ToString(), con);
             da.Fill(ds, "Condition");
             if (ds.Tables["Condition"].Rows.Count > 0)
             {
                 GridView1.DataSource = ds.Tables["Condition"];
                 GridView1.DataBind();
                 trexcel.Visible = true;
             }
             else
             {
                 GridView1.DataSource = null;
                 GridView1.DataBind();
                 trexcel.Visible = false;
             
             }
         }
         catch (Exception ex)
         {
             Utilities.CatchException(ex);
             JavaScript.Alert(ConfigurationManager.AppSettings["ExceptionMessage"].ToString());
         }
    
     
     }

     public override void VerifyRenderingInServerForm(Control control)
     {
         return;
     }

     protected void btnExcel_Click(object sender, ImageClickEventArgs e)
     {
         GridView1.AllowPaging = false;
         fillgrid();
         Context.Response.ClearContent();
         Context.Response.ContentType = "application/ms-excel";

         Context.Response.AddHeader("content-disposition", string.Format("attachment;filename={0}.xls",ddltype.SelectedItem.Text));
         Context.Response.Charset = "";
         System.IO.StringWriter stringwriter = new System.IO.StringWriter();
         HtmlTextWriter htmlwriter = new HtmlTextWriter(stringwriter);
         GridView1.RenderControl(htmlwriter);
         Context.Response.Write(stringwriter.ToString());
         Context.Response.End();
         
     }

     protected void ddltype_SelectedIndexChanged(object sender, EventArgs e)
     {
         fillexcise();
     }
     public void fillexcise()
     {
         try
         {
             if (ddltype.SelectedItem.Text == "Excise")
                 da = new SqlDataAdapter("select Excise_no as no from ExciseMaster where Status='3'", con);

             else if (ddltype.SelectedItem.Text == "ServiceTax")
                 da = new SqlDataAdapter("select ServiceTaxno as no from ServiceTaxMaster where Status='3'", con);
             da.Fill(ds, "nos");
             if (ds.Tables["nos"].Rows.Count > 0)
             {

                 ddlno.DataValueField = "no";
                 ddlno.DataTextField = "no";
                 ddlno.DataSource = ds.Tables["nos"];
                 ddlno.DataBind();
                 ddlno.Items.Insert(0, "Select");
                 ddlno.Items.Insert(1, "Select All");
             }
             else
             {
                 ddlno.Items.Insert(0, "Select");
             }


         }
         catch (Exception ex)
         {
             Utilities.CatchException(ex);
             JavaScript.Alert(ConfigurationManager.AppSettings["ExceptionMessage"].ToString());
         }

     }
}
