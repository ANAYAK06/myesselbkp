using System;
using System.Collections;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using System.Collections.Generic;
using System.IO;
using System.Drawing;
using System.Text;


public partial class ViewClientInvoice : System.Web.UI.Page
{
    SqlConnection con = new SqlConnection(ConfigurationManager.AppSettings["esselDB"]);
    SqlCommand cmd = new SqlCommand();
    SqlDataAdapter da = new SqlDataAdapter();
    SqlDataAdapter da1 = new SqlDataAdapter();
    SqlDataAdapter da2 = new SqlDataAdapter();
    DataSet ds = new DataSet();

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            LoadYear();
            clientid();
            trexcel.Visible = false;
            trclientdetails.Visible = false;
            trcccodedetails.Visible = false;
            trdatedetails.Visible = false;
            trbtndetails.Visible = false;
            ddlsubclientid.Enabled = false;
        }
    }
    
    protected void btnview_Click(object sender, EventArgs e)
    {
        try
        {
            string condition = "";         
            if (ddlyear.SelectedIndex != 0)
            {
                if (ddlmonth.SelectedIndex != 0)
                {
                    string yy = (ddlmonth.SelectedIndex < 4) ? (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() : ddlyear.SelectedValue;
                    condition = condition + " and  datepart(mm,invoice_date)=" + ddlmonth.SelectedValue + " and datepart(yy,invoice_date)=" + yy;                   
                }
                else
                {
                    condition = condition + " and convert(datetime,invoice_date) between '04/01/" + (Convert.ToInt32(ddlyear.SelectedValue)).ToString() + "' and '03/31/" + (Convert.ToInt32(ddlyear.SelectedValue) + 1).ToString() + "'";
                }
            }

            if (ddlclientid.SelectedItem.Text != "Select" && ddlclientid.SelectedItem.Text != "Select All")
            {
                condition = condition + " and client_id='" + ddlclientid.SelectedItem.Text + "'";
            }
            if (ddlsubclientid.Enabled == true)
            {
                if (ddlsubclientid.SelectedItem.Text != "select" && ddlsubclientid.SelectedItem.Text != "Select All")
                {
                    condition = condition + " and subclient_id='" + ddlsubclientid.SelectedItem.Text + "'";
                }
            }
            if (ddlcccode.SelectedItem.Text != "select" && ddlcccode.SelectedItem.Text != "select All")
            {
                condition = condition + " and i.cc_code='" + ddlcccode.SelectedValue+ "'";
            }
            if (ddlpo.SelectedItem.Text != "select" && ddlpo.SelectedItem.Text != "select All")
            {
                condition = condition + " and  i.PO_NO='" + ddlpo.SelectedItem.Text + "'";
            }
                      
            ViewState["condition"] = condition;
            if (condition.Substring(1, 3) == "and")
            {
                ViewState["conditionand"] = condition.Substring(4, condition.Length - 4);
            }
            else
            {
                ViewState["conditionand"] = condition;
            }
            fillgrid();           
           
        }
        catch (Exception ex)
        {
            Utilities.CatchException(ex);
        }
      
    }
    public void clientid()
    {
        
        ddlclientid.Items.Clear();
        ddlsubclientid.Items.Clear();
        ddlpo.Items.Clear();
        ddlcccode.Items.Clear();
        GridView1.DataSource = null;
        GridView1.DataBind();
        GridView3.DataSource = null;
        GridView3.DataBind();
        gvdeduction.DataSource = null;
        gvdeduction.DataBind();
        //GridView2.DataSource = null;
        //GridView2.DataBind();
        try
        {
            da = new SqlDataAdapter("Select client_name,client_id from client order by client_id", con);
            da.Fill(ds, "client");
            ddlclientid.DataTextField = "client_id";
            ddlclientid.DataValueField = "client_id";
            ddlclientid.DataSource = ds.Tables["client"];
            ddlclientid.DataBind();
            //lblclientid.Text = ds.Tables["client"].Rows[0].ItemArray[0].ToString();
            ddlclientid.Items.Insert(0, "select");
            ddlclientid.Items.Insert(1, "Select All");
            ddlsubclientid.Items.Insert(0, "select");
            ddlcccode.Items.Insert(0, "select");
            ddlpo.Items.Insert(0, "select");
        }
        catch (Exception ex)
        {
            Utilities.CatchException(ex);
        }
    }
    protected void ddlclientid_SelectedIndexChanged(object sender, EventArgs e)
    {
        da = new SqlDataAdapter("Select client_name from client where client_id='" + ddlclientid.SelectedItem.Text + "' ", con);
        da.Fill(ds, "clientname");
        if (ddlclientid.SelectedItem.Text != "Select All" && ddlclientid.SelectedItem.Text != "select")
        {
            lblclientid.Text = ds.Tables["clientname"].Rows[0].ItemArray[0].ToString();
        }
        else
        {
            lblclientid.Text = "";
        }
        lblsubclientid.Text = "";
        ddlsubclientid.Items.Clear();
        ddlcccode.Items.Clear();
        ddlpo.Items.Clear();
        ddlcccode.Items.Insert(0, "select");
        ddlpo.Items.Insert(0, "select");
        GridView1.DataSource = null;
        GridView1.DataBind();
        GridView3.DataSource = null;
        GridView3.DataBind();
        gvdeduction.DataSource = null;
        gvdeduction.DataBind();
        //GridView2.DataSource = null;
        //GridView2.DataBind();
        try
        {
            da = new SqlDataAdapter("select distinct subclient_id from subclient where  client_id='" + ddlclientid.SelectedItem.Text + "' ", con);
            da.Fill(ds, "subclient");
            if (ds.Tables["subclient"].Rows.Count > 0)
            {
                ddlsubclientid.Enabled = true;
                ddlsubclientid.DataTextField = "subclient_id";
                ddlsubclientid.DataValueField = "subclient_id";                
                ddlsubclientid.DataSource = ds.Tables["subclient"];
                ddlsubclientid.DataBind();
                ddlsubclientid.Items.Insert(0, "select");
                ddlsubclientid.Items.Insert(1, "Select All");
                
            }
            else
            {
                ddlsubclientid.Items.Insert(0, "select");
                ddlsubclientid.Enabled = false;
                fillcccode();
            }
        }
        catch (Exception ex)
        {
            Utilities.CatchException(ex);
        }
    }
    public void fillcccode()
    {
        ddlcccode.Items.Clear();
        if (ddlclientid.SelectedItem.Text != "Select All" && ddlclientid.SelectedItem.Text != "select")
        {
            da = new SqlDataAdapter("select i.cc_code, i.cc_code+ ',' +c.cc_name as ccname  from invoice i join cost_center c on i.cc_code=c.cc_code where client_id='" + ddlclientid.SelectedItem.Text + "' GROUP by i.cc_code,c.cc_name ORDER BY CASE WHEN i.cc_code='CCC' THEN i.cc_code end ASC ,CASE WHEN i.cc_code!='CCC' THEN CONVERT(INT,REPLACE(i.CC_Code,'CC-','')) END ASC ", con);
        }
        else
        {
            da = new SqlDataAdapter("select i.cc_code, i.cc_code+ ',' +c.cc_name as ccname  from invoice i join cost_center c on i.cc_code=c.cc_code GROUP by i.cc_code,c.cc_name ORDER BY CASE WHEN i.cc_code='CCC' THEN i.cc_code end ASC ,CASE WHEN i.cc_code!='CCC' THEN CONVERT(INT,REPLACE(i.CC_Code,'CC-','')) END ASC", con);
        }

        da.Fill(ds, "cccodes");
        ddlcccode.DataTextField = "ccname";
        ddlcccode.DataValueField = "cc_code";
        ddlcccode.DataSource = ds.Tables["cccodes"];
        ddlcccode.DataBind();
        ddlcccode.Items.Insert(0, "select");
        ddlcccode.Items.Insert(1, "select All");
        ddlpo.Items.Insert(0, "select");
    }
    protected void ddlsubclientid_SelectedIndexChanged(object sender, EventArgs e)
    {
        if (ddlsubclientid.Enabled == true && ddlsubclientid.SelectedItem.Text != "select" && ddlsubclientid.SelectedItem.Text != "Select All")
        {
            da = new SqlDataAdapter("Select branch from subclient where subclient_id='" + ddlsubclientid.SelectedItem.Text + "' ", con);
            da.Fill(ds, "subclientname");
            lblsubclientid.Text = ds.Tables["subclientname"].Rows[0].ItemArray[0].ToString();
            ddlpo.Items.Clear();
            ddlcccode.Items.Clear();
            GridView1.DataSource = null;
            GridView1.DataBind();

            try
            {
                ddlcccode.Items.Clear();
                da = new SqlDataAdapter("select   distinct i.cc_code, i.cc_code+ ',' +c.cc_name as ccname  from invoice i join cost_center c on i.cc_code=c.cc_code where  subclient_id='" + ddlsubclientid.SelectedItem.Text + "'  ", con);
                da.Fill(ds, "cccode");
                ddlcccode.DataTextField = "ccname";
                ddlcccode.DataValueField = "cc_code";
                ddlcccode.DataSource = ds.Tables["cccode"];
                ddlcccode.DataBind();
                ddlcccode.Items.Insert(0, "select");
                //ddlcccode.Items.Insert(1, "select All");
                ddlpo.Items.Insert(0, "select");

            }
            catch (Exception ex)
            {
                Utilities.CatchException(ex);
            }
        }
        else
        {
            fillcccode();
        }
    }
    protected void ddlcccode_SelectedIndexChanged(object sender, EventArgs e)
    {
        ddlpo.Items.Clear();
        GridView1.DataSource = null;
        GridView1.DataBind();
        GridView3.DataSource = null;
        GridView3.DataBind();
        gvdeduction.DataSource = null;
        gvdeduction.DataBind();
        //GridView2.DataSource = null;
        //GridView2.DataBind();
        try
        {
            if (ddlcccode.SelectedItem.Text != "select" && ddlcccode.SelectedItem.Text != "select All")
            {
                if (ddlsubclientid.Enabled == true && ddlsubclientid.SelectedItem.Text != "select" && ddlsubclientid.SelectedItem.Text != "Select All")
                {
                    da = new SqlDataAdapter("select distinct po_no from invoice where  cc_code='" + ddlcccode.SelectedValue + "' and  subclient_id='" + ddlsubclientid.SelectedItem.Text + "'  and status<>'cancel'   ", con);
                }
                else
                {
                    da = new SqlDataAdapter("select distinct po_no from invoice where  cc_code='" + ddlcccode.SelectedValue + "' and status<>'cancel'   ", con);
                }
                da.Fill(ds, "pono");
                if (ds.Tables["pono"].Rows.Count > 0)
                {
                    ddlpo.DataTextField = "po_no";
                    ddlpo.DataValueField = "po_no";
                    ddlpo.DataSource = ds.Tables["pono"];
                    ddlpo.DataBind();
                    ddlpo.Items.Insert(0, "select");
                    ddlpo.Items.Insert(1, "select All");
                }
                else
                {
                    ddlpo.Items.Insert(0, "select");
                }
            }
            else if (ddlcccode.SelectedItem.Text == "select All")
            {
                if (ddlsubclientid.Enabled == true && ddlsubclientid.SelectedItem.Text != "select" && ddlsubclientid.SelectedItem.Text != "Select All")
                {
                    da = new SqlDataAdapter("select distinct po_no from invoice where  subclient_id='" + ddlsubclientid.SelectedItem.Text + "'  and status<>'cancel'   ", con);
                }
                else if (ddlclientid.SelectedItem.Text != "Select All" && ddlclientid.SelectedItem.Text != "select")
                {
                    da = new SqlDataAdapter("select distinct po_no from invoice where  client_id='" + ddlclientid.SelectedItem.Text + "'  and status<>'cancel'   ", con);
                }
                else
                {
                    da = new SqlDataAdapter("select distinct po_no from invoice where status<>'cancel'   ", con);
                }
                da.Fill(ds, "pono");
                if (ds.Tables["pono"].Rows.Count > 0)
                {
                    ddlpo.DataTextField = "po_no";
                    ddlpo.DataValueField = "po_no";
                    ddlpo.DataSource = ds.Tables["pono"];
                    ddlpo.DataBind();
                    ddlpo.Items.Insert(0, "select");
                    ddlpo.Items.Insert(1, "select All");
                }
                else
                {
                    ddlpo.Items.Insert(0, "select");
                }
            }
            else
            {
                ddlpo.Items.Insert(0, "select");
            }
         
           
        }
        catch (Exception ex)
        {
            Utilities.CatchException(ex);
        }
    }
   
    public void LoadYear()
    {
        for (int i = 2005; i <= System.DateTime.Now.Year; i++)
        {
            if (System.DateTime.Now.Month < 4 && System.DateTime.Now.Year == i)
            {
            }
            else
            {
                ddlyear.Items.Add(new ListItem(i.ToString() + "-" + (i + 1).ToString().Substring(2, 2), i.ToString()));
            }

        }
        ddlyear.Items.Insert(0, "Any Year");
    }
    protected void rbtntype_SelectedIndexChanged(object sender, EventArgs e)
    {

        if (rbtntype.SelectedValue == "Before Payment" || rbtntype.SelectedValue == "After Payment" || rbtntype.SelectedValue == "All Records")
        {
            trclientdetails.Visible = true;
            trcccodedetails.Visible = true;
            trdatedetails.Visible = true;
            trbtndetails.Visible = true;
        }
        else
        {
            trclientdetails.Visible = false;
            trcccodedetails.Visible = false;
            trdatedetails.Visible = false;
            trbtndetails.Visible = false;
        }
        clear();       
    }

    public void clear()
    {
        ddlclientid.SelectedIndex = 0;
        ddlsubclientid.SelectedIndex = 0;
        ddlcccode.SelectedIndex = 0;
        ddlpo.SelectedIndex = 0;
        ddlmonth.SelectedIndex = 0;
        ddlyear.SelectedIndex = 0;
        GridView1.DataSource = null;
        GridView1.DataBind();
        gvdeduction.DataSource = null;
        gvdeduction.DataBind();
        GridView3.DataSource = null;
        GridView3.DataBind();
        //GridView2.DataSource = null;
        //GridView2.DataBind();
        lblclientid.Text = "";
        lblsubclientid.Text = "";
    }
    public void fillgrid()
    {
        try
        {
            //if (ddlcccode.SelectedValue != "select All")
            //{
            //da = new SqlDataAdapter("select cc_subtype from cost_center where cc_code='" + ddlcccode.SelectedValue + "'", con);
            //da.Fill(ds, "ccsubtype");
            //if (ds.Tables["ccsubtype"].Rows.Count > 0)
            //{
            //    if (ds.Tables["ccsubtype"].Rows[0][0].ToString() != "Manufacturing")
            //    {
            if (ddlclientid.SelectedItem.Text != "Select All" && ddlclientid.SelectedItem.Text != "select")
            {
                if (rbtntype.SelectedValue == "After Payment")
                {
                    //da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(NetServiceTax)+SUM(NetEdcess)+SUM(NetHedcess)),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0)),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total AnyOther Tax Credit' as [Description],CAST(0 AS decimal(25,2))as [Salestax]", con);
                    da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((CAST(b.credit AS decimal(25,2))))AS [credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;  Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //correction required da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all  Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending')  AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all  Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending')  AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);


                }
                else if (rbtntype.SelectedValue == "Before Payment")
                {
                    //da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(NetServiceTax)+SUM(NetEdcess)+SUM(NetHedcess)),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0)),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total AnyOther Tax Credit' as [Description],CAST(0 AS decimal(25,2))as [Salestax]", con);
                    da = new SqlDataAdapter("select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,''as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i1 ON cd.InvoiceNo=i1.InvoiceNo WHERE cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code!=i.CC_Code AND client_id=i.client_id and subclient_id=i.subclient_id))AS [credit],paymenttype as  paymenttype from  invoice i where status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "   order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)) desc;  Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount] from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //correction requiredda2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);


                }
                else if (rbtntype.SelectedValue == "All Records")
                {
                    da = new SqlDataAdapter("SELECT * FROM(select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,''as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i1 ON cd.InvoiceNo=i1.InvoiceNo WHERE cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code!=i.CC_Code AND client_id=i.client_id and subclient_id=i.subclient_id))AS [credit],paymenttype as  paymenttype from  invoice i where i.status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((CAST(b.credit AS decimal(25,2))))AS [credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")tot order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount] from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //correction requiredda2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null)  and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "  union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null)  and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);

                }
            }
            else if (ddlclientid.SelectedItem.Text == "Select All" && ddlclientid.SelectedItem.Text != "select")
            {
                if (rbtntype.SelectedValue == "After Payment")
                {
                    //da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(NetServiceTax)+SUM(NetEdcess)+SUM(NetHedcess)),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0)),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total AnyOther Tax Credit' as [Description],CAST(0 AS decimal(25,2))as [Salestax]", con);
                    da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((CAST(b.credit AS decimal(25,2))))AS [credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + "  order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;  Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount] from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') " + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + "", con);
                    //correction requiredda2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " )+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " )+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('Credit','Credit Pending') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "", con);

                }
                else if (rbtntype.SelectedValue == "Before Payment")
                {
                    //da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(NetServiceTax)+SUM(NetEdcess)+SUM(NetHedcess)),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status='credit' and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0)),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status='credit' and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total AnyOther Tax Credit' as [Description],CAST(0 AS decimal(25,2))as [Salestax]", con);
                    da = new SqlDataAdapter("select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,''as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i1 ON cd.InvoiceNo=i1.InvoiceNo WHERE cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code!=i.CC_Code AND client_id=i.client_id and subclient_id=i.subclient_id))AS [credit],paymenttype as  paymenttype from  invoice i where status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "   order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)) desc;  Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount] from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') " + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  " + ViewState["condition"].ToString() + "", con);
                    //correction requiredda2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "  union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  " + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status i.status in ('1','2') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount] from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status in ('1','2') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "", con);


                }
                else if (rbtntype.SelectedValue == "All Records")
                {
                    da = new SqlDataAdapter("SELECT * FROM(select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,''as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i1 ON cd.InvoiceNo=i1.InvoiceNo WHERE cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code!=i.CC_Code AND client_id=i.client_id and subclient_id=i.subclient_id))AS [credit],paymenttype as  paymenttype from  invoice i where i.status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt ,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,((CAST(b.credit AS decimal(25,2))))AS [credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + ")tot order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount] from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') " + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + "  UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') AND (b.status!='Rejected' or b.status is null) " + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') " + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount]  ", con);
                    da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE " + ViewState["conditionand"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " )),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  " + ViewState["condition"].ToString() + "", con);
                    //correction requiredda2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "  union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') " + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where " + ViewState["conditionand"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing')  " + ViewState["condition"].ToString() + "", con);
                    //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull(((select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST','Excise Tax','VAT Tax') and i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + ")+(select ((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)))) from Invoice i join BankBook b on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold')  " + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') " + ViewState["condition"].ToString() + "", con);

                }
            }
            //}

            //else if (ds.Tables["ccsubtype"].Rows[0][0].ToString() == "Manufacturing")
            //{
            //    if (rbtntype.SelectedValue == "After Payment")
            //    {
            //        da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(Netexciseduty,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(Netexciseduty,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+SUM(isnull(netsalestax,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount] Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount] ", con);
            //        da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //        //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
            //        da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //    }
            //    else if (rbtntype.SelectedValue == "Before Payment")
            //    {
            //        da = new SqlDataAdapter("select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,'' as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(Netexciseduty,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],paymenttype as  paymenttype from  invoice i  where i.status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(Netexciseduty,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+SUM(isnull(netsalestax,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount] Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount] ", con);
            //        da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //        //da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice i ON i.InvoiceNo=ct.InvoiceNo WHERE  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " )),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status='credit' AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " ", con);
            //        da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //    }
            //    else if (rbtntype.SelectedValue == "All Records")
            //    {
            //        da = new SqlDataAdapter("SELECT  * FROM(select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(Netexciseduty,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status in ('Credit','Credit Pending') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') AND (b.status!='Rejected' or b.status is null) and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all select InvoiceNo,PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,'' as date,CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(Netexciseduty,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,(SELECT replace((ISNULL(SUM(cast(ct.TaxValue as decimal(25,2))),0)),'.0000','.00') FROM Client_Taxes ct JOIN Invoice iv ON iv.InvoiceNo=ct.InvoiceNo WHERE iv.client_id=i.client_id AND iv.subclient_id=i.subclient_id AND iv.CC_Code=i.CC_Code AND iv.PO_NO=i.PO_NO AND iv.InvoiceNo=i.InvoiceNo)AS taxamt,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT,(SELECT replace((ISNULL(SUM(cast(cd.Deducation_Value as decimal(25,2))),0)),'.0000','.00') FROM Client_Deducations cd JOIN Invoice ivv ON ivv.InvoiceNo=cd.InvoiceNo WHERE ivv.client_id=i.client_id AND ivv.subclient_id=i.subclient_id AND ivv.CC_Code=i.CC_Code AND ivv.PO_NO=i.PO_NO AND ivv.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code)AS ClientDed ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],paymenttype as  paymenttype from  invoice i  where i.status in ('1','2') and paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")tot order by CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(Netexciseduty,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+SUM(isnull(netsalestax,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount] Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0)) +(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('VAT Tax') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Total Taxes Credit' as [Description],coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) as [Taxes]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Excise Tax','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Taxes' as [Description],cast(0 as decimal(25,2))[Total Tax Amount] ", con);
            //        da1 = new SqlDataAdapter("Select 'Deduction For Same CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo AND cd.CC_Code=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Deduction For Other CC' as [Debit Summary],replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00') as Amount FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and  cd.CC_Code!=i.CC_Code WHERE client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //        da2 = new SqlDataAdapter("Select 'Net Receipt in Bank' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Actual basic receipt against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " union all Select 'Effective basic Receipt Against CC' as [Description],CAST(isnull((Sum(isnull(b.Credit,0))-(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))+(select coalesce((Sum(isnull(CAST(TaxValue AS DECIMAL(16,2)),0))),0.00) from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) JOIN client_taxes ct ON ct.invoiceno=i.invoiceno where Taxtype in('Service Tax','Cess','GST') and  i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0))+(select replace(isnull(SUM(cast(Deducation_Value as decimal(25,2))),0),'.0000','.00')FROM Client_Deducations cd JOIN Invoice i ON cd.InvoiceNo=i.InvoiceNo and cd.CC_Code!=i.CC_Code where  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + ")),0) AS decimal(25,2))as [Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') AND (b.status!='Rejected' or b.status is null) and b.paymenttype in ('Retention','Hold','Advance','Invoice Service','Trading Supply','Manufacturing')  and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + "", con);
            //    }
            //}
            da.Fill(ds, "fill");
            da1.Fill(ds, "fillded");
            //da2.Fill(ds, "fillreceipt");
            if (ds.Tables["fill"].Rows.Count > 0)
            {
                GridView1.DataSource = ds.Tables["fill"];
                GridView1.DataBind();
                GridView3.DataSource = ds.Tables["fill1"];
                GridView3.DataBind();
                if (ds.Tables["fillded"].Rows.Count > 0)
                {
                    gvdeduction.DataSource = ds.Tables["fillded"];
                    gvdeduction.DataBind();
                }
                else
                {
                    gvdeduction.DataSource = null;
                    gvdeduction.DataBind();
                }
                //if (ds.Tables["fillreceipt"].Rows.Count > 0)
                //{
                //    GridView2.DataSource = ds.Tables["fillreceipt"];
                //    GridView2.DataBind();
                //}
                //else
                //{
                //    GridView2.DataSource = null;
                //    GridView2.DataBind();
                //}
                trexcel.Visible = true;
            }
            else if (ds.Tables["fill1"].Rows.Count > 0)
            {
                GridView3.DataSource = ds.Tables["fill1"];
                GridView3.DataBind();
            }
            else
            {
                GridView1.DataSource = null;
                GridView1.DataBind();
                GridView3.DataSource = null;
                GridView3.DataBind();
                trexcel.Visible = false;
            }
        }
        //}
        //else
        //{
        //    da = new SqlDataAdapter("select b.InvoiceNo,i.PO_NO,RA_NO,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),invoice_Date)), 106), ' ', '-')invoice_date,REPLACE(CONVERT(VARCHAR(11),CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)), 106), ' ', '-')date,i.CC_Code,replace(isnull(BasicValue,0),'.0000','.00')BasicValue,replace(isnull(NetEDcess,0),'.0000','.00')NetEDcess,replace(isnull(NetHEDcess,0),'.0000','.00')NetHEDcess,replace(isnull(NetServiceTax,0),'.0000','.00')NetServiceTax,replace(isnull(NetSalesTax,0),'.0000','.00')NetSalesTax,replace(isnull(Total,0),'.0000','.00')Total,replace(isnull(TDS,0),'.0000','.00')TDS,replace(isnull(Retention,0),'.0000','.00')Retention,replace(isnull(Advance,0),'.0000','.00')Advance,replace(isnull(Hold,0),'.0000','.00')Hold,replace(isnull(WCT,0),'.0000','.00')WCT ,replace(isnull(AnyOther,0),'.0000','.00')AnyOther,CAST(b.credit AS decimal(25,2))[credit],b.paymenttype as  paymenttype from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance','Retention','Hold') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " order by CONVERT(DATETIME,CONVERT(VARCHAR(11),Date)) desc;Select 'Total Net Credit Against Advance' as [Credit Summary],cast(isnull(sum(b.credit),0)-isnull((Sum(NetServiceTax)+SUM(NetEdcess)+SUM(NetHedcess)),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where i.status not in ('cancel') and b.paymenttype in ('Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " Union All Select 'Total Net Credit Against Invoice' as [Description],cast(isnull(sum(b.credit),0)-isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetSalesTax,0))+SUM(isnull(NetHedcess,0))),0) as decimal(25,2))[Total Net Amount]  from bankbook b join invoice i on b.invoiceno=i.invoiceno where i.status not in ('cancel') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION All  Select 'Total Net Credit Against Hold' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Hold') and  client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total Net Credit Against Retention' as [Description],cast(isnull(sum(b.credit),0) as decimal(25,2))[Total Net Amount]   from bankbook b join invoice i on b.invoiceno=i.invoiceno where  b.paymenttype in ('Retention') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total' as [Description],cast(0 as decimal(25,2))[Total Net Amount]  UNION ALL Select 'Total ServiceTax Credit' as [Description],CAST(isnull((Sum(isnull(NetServiceTax,0))+SUM(isnull(NetEdcess,0))+SUM(isnull(NetHedcess,0))),0) AS decimal(25,2))as [servicetax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total SalesTax Credit' as [Description],CAST(isnull(Sum(isnull(NetSalesTax,0)),0) AS decimal(25,2))as [Salestax]  from bankbook b join invoice i on (b.invoiceno=i.invoiceno or b.Transaction_No=i.Transaction_No) where  i.status not in ('cancel') and b.paymenttype in ('Invoice Service','Trading Supply','Manufacturing','Advance') and client_id='" + ddlclientid.SelectedItem.Text + "'" + ViewState["condition"].ToString() + " UNION ALL Select 'Total AnyOther Tax Credit' as [Description],CAST(0 AS decimal(25,2))as [Salestax]", con);
        //    da.Fill(ds, "fill");
        //    if (ds.Tables["fill"].Rows.Count > 0)
        //    {
        //        GridView1.DataSource = ds.Tables["fill"];
        //        GridView1.DataBind();
        //        GridView3.DataSource = ds.Tables["fill1"];
        //        GridView3.DataBind();
        //        trexcel.Visible = true;
        //    }
        //    else
        //    {

            //        GridView1.DataSource = null;
        //        GridView1.DataBind();
        //        GridView3.DataSource = null;
        //        GridView3.DataBind();
        //        trexcel.Visible = false;
        //    }

            //}

        catch (Exception ex)
        {
            Utilities.CatchException(ex);
        }
    }
   
    protected void lnkbtn_Click(object sender, EventArgs e)
    {

    }  
    protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow)
        {
            HiddenField hf = (HiddenField)e.Row.FindControl("h1");
            if (hf.Value != "Retention" && hf.Value != "Hold")
            {
                Basicvalue += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "BasicValue"));
                NetEDcess += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "NetEDcess"));
                NetHEDcess += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "NetHEDcess"));
                Servicetax += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "NetServiceTax"));
                Salestax += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "NetSalestax"));
                TaxAmt += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "taxamt"));
                Total += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Total"));
                TDS += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "TDS"));
                Retention += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Retention"));
                Advance += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Advance"));
                hold += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Hold"));
                WCT += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "WCT"));
                Ded += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "ClientDed"));
                anyother += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "AnyOther"));
            }
            else
            {
                e.Row.Cells[6].Text = "0";
                e.Row.Cells[7].Text = "0";
                e.Row.Cells[8].Text = "0";
                e.Row.Cells[9].Text = "0";
                e.Row.Cells[10].Text = "0";
                e.Row.Cells[11].Text = "0";
                e.Row.Cells[12].Text = "0";
                e.Row.Cells[13].Text = "0";
                e.Row.Cells[14].Text = "0";
                e.Row.Cells[15].Text = "0";
                e.Row.Cells[16].Text = "0";
                e.Row.Cells[17].Text = "0";
                e.Row.Cells[18].Text = "0";
                e.Row.Cells[19].Text = "0";

            }
            e.Row.Attributes.Add("onclick", "OpenNewPage('" + e.Row.Cells[0].Text + "','" + e.Row.Cells[5].Text + "')");
            Amount += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Credit"));
        }
        if (e.Row.RowType == DataControlRowType.Footer)
        {
            e.Row.Cells[6].Text = String.Format("Rs. {0:#,##,##,###.00}", Basicvalue);
            e.Row.Cells[7].Text = String.Format("Rs. {0:#,##,##,###.00}", Servicetax);
            e.Row.Cells[8].Text = String.Format("Rs. {0:#,##,##,###.00}", NetEDcess);
            e.Row.Cells[9].Text = String.Format("Rs. {0:#,##,##,###.00}", NetHEDcess);
            e.Row.Cells[10].Text = String.Format("Rs. {0:#,##,##,###.00}", Salestax);
            e.Row.Cells[11].Text = String.Format("Rs. {0:#,##,##,###.00}", TaxAmt);
            e.Row.Cells[12].Text = String.Format("Rs. {0:#,##,##,###.00}", Total);
            e.Row.Cells[13].Text = String.Format("Rs. {0:#,##,##,###.00}", TDS);
            e.Row.Cells[14].Text = String.Format("Rs. {0:#,##,##,###.00}", Retention);
            e.Row.Cells[15].Text = String.Format("Rs. {0:#,##,##,###.00}", Advance);
            e.Row.Cells[16].Text = String.Format("Rs. {0:#,##,##,###.00}", hold);
            e.Row.Cells[17].Text = String.Format("Rs. {0:#,##,##,###.00}", WCT);
            e.Row.Cells[18].Text = String.Format("Rs. {0:#,##,##,###.00}", Ded);
            e.Row.Cells[19].Text = String.Format("Rs. {0:#,##,##,###.00}", anyother);
            e.Row.Cells[20].Text = String.Format("Rs. {0:#,##,##,###.00}", Amount);
        }
        
    }
    protected void GridView1_PageIndexChanging1(object sender, GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        fillgrid();
    }
    private decimal Basicvalue = (decimal)0.0;
    private decimal Servicetax = (decimal)0.0;
    private decimal Salestax = (decimal)0.0;
    private decimal Total = (decimal)0.0;
    private decimal TDS = (decimal)0.0;
    private decimal Retention = (decimal)0.0;
    private decimal Advance = (decimal)0.0;
    private decimal hold = (decimal)0.0;
    private decimal anyother = (decimal)0.0;
    private decimal NetAmount = (decimal)0.0;
    private decimal Amount = (decimal)0.0;
    private decimal NetEDcess = (decimal)0.0;
    private decimal NetHEDcess = 0;
    private decimal WCT = 0;

    private decimal TaxAmt = 0;
    private decimal Ded = 0;
    private decimal TaxAmount = (decimal)0.0;
    protected void btnreset_Click(object sender, EventArgs e)
    {
        //CascadingDropDown1.SelectedValue= "select";
        //CascadingDropDown2.SelectedValue= "select";
        //ddlmonth.SelectedItem.Text = "Select Month";
        //ddlyear.SelectedItem.Text = "Any Year";
        Response.Redirect("ViewClientInvoice.aspx");

    }
    public override void VerifyRenderingInServerForm(Control control)
    {
        /*Verifies that the control is rendered */
    }
    protected void btnExcel_Click(object sender, ImageClickEventArgs e)
    {
        Response.ClearContent();
        Response.Buffer = true;
        string s = ddlcccode.SelectedValue + " Status.xls";
        Response.AddHeader("content-disposition", string.Format("attachment; filename={0}", s));
        Response.ContentType = "application/ms-excel";
        //StringWriter sw = new StringWriter();
        //HtmlTextWriter htw = new HtmlTextWriter(sw);
        System.IO.StringWriter sw =
         new System.IO.StringWriter();
        System.Web.UI.HtmlTextWriter htw =
           new System.Web.UI.HtmlTextWriter(sw);
        Panel2.RenderControl(htw);
        GridView1.AllowPaging = false;
        GridView1.AlternatingRowStyle.BackColor = System.Drawing.Color.White;
        GridView1.DataBind();
        //Change the Header Row back to white color
        GridView1.HeaderRow.Style.Add("background-color", "#FFFFFF");
        //Applying stlye to gridview header cells
        for (int i = 0; i < GridView1.HeaderRow.Cells.Count; i++)
        {
            GridView1.HeaderRow.Cells[i].Style.Add("background-color", "#507CD1");
        }
        int j = 1;
        //This loop is used to apply stlye to cells based on particular row
        foreach (GridViewRow gvrow in GridView1.Rows)
        {
            gvrow.BackColor = System.Drawing.Color.White;
            if (j <= GridView1.Rows.Count)
            {
                if (j % 2 != 0)
                {
                    for (int k = 0; k < gvrow.Cells.Count; k++)
                    {
                        gvrow.Cells[k].Style.Add("background-color", "#EFF3FB");
                    }
                }
            }
            j++;
        }

        Response.Write(sw.ToString());
        Response.End();
    }
    private decimal GrandTotal = 0;
    protected void GridView3_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow)
        {
            //if (e.Row.Cells[0].Text == "Total Net Credit Against Advance" || e.Row.Cells[0].Text == "Total Net Credit Against Invoice" || e.Row.Cells[0].Text == "Total Net Credit Against Hold" || e.Row.Cells[0].Text == "Total Net Credit Against Retention")
            //{
            //    Amount += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Total Net Amount"));
            //}
            if (e.Row.Cells[0].Text == "Total")
            {
                Amount = Convert.ToDecimal(ds.Tables["fill1"].Rows[0][1].ToString()) + Convert.ToDecimal(ds.Tables["fill1"].Rows[1][1].ToString())+ Convert.ToDecimal(ds.Tables["fill1"].Rows[2][1].ToString())+ Convert.ToDecimal(ds.Tables["fill1"].Rows[3][1].ToString());

                e.Row.Cells[1].Text = Amount.ToString();
                e.Row.Cells[1].BackColor = System.Drawing.Color.LightBlue;
                e.Row.Cells[0].BackColor = System.Drawing.Color.LightBlue;
            }
            if (e.Row.Cells[0].Text == "Total Taxes")
            {
                TaxAmount = Convert.ToDecimal(ds.Tables["fill1"].Rows[5][1].ToString()) + Convert.ToDecimal(ds.Tables["fill1"].Rows[6][1].ToString()) + Convert.ToDecimal(ds.Tables["fill1"].Rows[7][1].ToString());
                e.Row.Cells[1].Text = TaxAmount.ToString();
                e.Row.Cells[1].BackColor = System.Drawing.Color.LightBlue;
                e.Row.Cells[0].BackColor = System.Drawing.Color.LightBlue;
            }
            GrandTotal += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Total Net Amount"));
         
        }
        if (e.Row.RowType == DataControlRowType.Footer)
        {
            e.Row.Cells[0].Text = "Grand Total";
            e.Row.Cells[1].Text = String.Format("Rs. {0:#,##,##,###.00}", GrandTotal);

        }
    }
    private decimal Grandded = 0;
    protected void gvdeduction_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow)
        {
            e.Row.Cells[0].HorizontalAlign = HorizontalAlign.Right;
            Grandded += Convert.ToDecimal(DataBinder.Eval(e.Row.DataItem, "Amount"));

        }
        if (e.Row.RowType == DataControlRowType.Footer)
        {
            e.Row.Cells[0].HorizontalAlign = HorizontalAlign.Right;
            e.Row.Cells[1].HorizontalAlign = HorizontalAlign.Right;
            e.Row.Cells[0].Text = "Grand Total";
            e.Row.Cells[1].Text = String.Format("Rs. {0:#,##,##,###.00}", Grandded);

        }
    }


   
}
